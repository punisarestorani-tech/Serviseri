import { Card } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { format } from "date-fns";
import { Repeat } from "lucide-react";
import { getRecurrencePatternLabel } from "@/lib/recurringUtils";
import { useTranslation } from "@/i18n";

type TaskStatus = "pending" | "in_progress" | "completed";
type TaskType = "one-time" | "recurring";
type RecurrencePattern = "none" | "weekly" | "monthly" | "quarterly" | "semi-annual" | "yearly";

interface TaskCardProps {
  taskId: string;
  description: string;
  clientName: string;
  applianceName?: string;
  status: TaskStatus;
  createdAt: Date;
  taskType?: TaskType;
  recurrencePattern?: RecurrencePattern;
  recurrenceInterval?: number;
  isAutoGenerated?: boolean;
  onClick?: () => void;
}

export default function TaskCard({
  taskId,
  description,
  clientName,
  applianceName,
  status,
  createdAt,
  taskType = "one-time",
  recurrencePattern = "none",
  recurrenceInterval = 1,
  isAutoGenerated = false,
  onClick,
}: TaskCardProps) {
  const t = useTranslation();
  const isRecurring = taskType === "recurring";
  
  return (
    <Card
      className={`p-5 cursor-pointer overflow-visible transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1 group ${
        isRecurring ? "border-l-4 border-l-primary bg-gradient-to-r from-primary/5 to-transparent" : "hover:border-primary/30"
      }`}
      onClick={onClick}
      data-testid={`card-task-${taskId}`}
    >
      {applianceName && (
        <div className="text-base font-medium mb-2" data-testid={`text-appliance-name-${taskId}`}>
          {applianceName}
        </div>
      )}
      
      <div className="flex items-start gap-4 mb-3">
        <div className="flex items-center gap-2 flex-1">
          {isRecurring && <Repeat className="w-4 h-4 text-primary" />}
          <h3 className="text-lg font-medium flex-1" data-testid={`text-task-description-${taskId}`}>
            {description}
          </h3>
        </div>
      </div>
      
      <div className="flex flex-col gap-1 mb-2">
        <div className="flex items-center gap-2 text-base text-muted-foreground">
          <span data-testid={`text-client-name-${taskId}`}>{clientName}</span>
          <span>â€¢</span>
          <span className="text-sm" data-testid={`text-created-date-${taskId}`}>
            {format(createdAt, "MMM d, yyyy")}
          </span>
        </div>
      </div>

      {isRecurring && (
        <div className="flex items-center gap-2 mt-3">
          <Badge variant="secondary" className="text-xs" data-testid={`badge-recurrence-${taskId}`}>
            {getRecurrencePatternLabel(recurrencePattern, recurrenceInterval || 1)}
          </Badge>
          {isAutoGenerated && (
            <Badge variant="outline" className="text-xs" data-testid={`badge-auto-generated-${taskId}`}>
              {t.tasks.autoGenerated}
            </Badge>
          )}
        </div>
      )}
    </Card>
  );
}
